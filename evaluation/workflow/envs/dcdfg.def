Bootstrap: docker
From: mambaorg/micromamba

%environment
    export PYTHONPATH=/opt/dcdfg:$PYTHONPATH

%post
    apt update && apt install -y git && rm -rf /var/lib/apt/lists/*
    git clone https://github.com/Genentech/dcdfg /opt/dcdfg
    cd /opt/dcdfg
    micromamba install -n base -y -c conda-forge \
        cdt=0.5.23 \
        networkx=2.6.3 \
        numba=0.55.0 \
        numpy=1.21.5 \
        pandas=1.4.0 \
        pytorch-lightning=1.5.10 \
        scanpy=1.9.1 \
        scikit-learn=1.1.2 \
        setuptools=59.5.0 \
        pytorch-gpu=1.10.2 \
        tqdm=4.62.3 \
        wandb=0.12.11 \
        "matplotlib<3.7" \
        scikit-misc
    micromamba run pip install --no-cache-dir -r requirements.txt
    micromamba clean -y -a

%runscript
    exec micromamba run python "$@"
